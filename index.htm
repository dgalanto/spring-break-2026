<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Galantowicz Spring Break 2026 Planning</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e6fbff 0%, #d0f0f7 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.12);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 8px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 1.05em;
        }

        /* Search bar */
        .ai-search {
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: center;
            margin: 18px 0 30px 0;
        }

        .ai-search form {
            display: flex;
            gap: 10px;
            width: 100%;
            max-width: 900px;
            align-items: center;
        }

        .ai-search input[type="search"] {
            flex: 1;
            padding: 12px 14px;
            border-radius: 10px;
            border: 1px solid #cfeef6;
            background: #f7feff;
            font-size: 1em;
            outline: none;
            transition: box-shadow 0.12s;
        }

        .ai-search input[type="search"]:focus {
            box-shadow: 0 0 0 4px rgba(34, 193, 195, 0.08);
            border-color: #4ecdc4;
        }

        .ai-search select {
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #e0f2f5;
            background: #fff;
            font-size: 0.95em;
        }

        .ai-search button {
            padding: 11px 18px;
            background: linear-gradient(180deg, #2bb7c7 0%, #19a8b7 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.08s;
        }

        .ai-search button:active {
            transform: translateY(1px);
        }

        .search-meta {
            text-align: center;
            font-size: 0.9em;
            color: #556;
            margin-bottom: 18px;
        }

        /* Results */
        #search-results {
            margin-top: 18px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 16px;
        }

        .result-card {
            background: linear-gradient(180deg, #ffffff 0%, #fbffff 100%);
            border: 1px solid #e6f7f9;
            border-radius: 12px;
            padding: 14px;
            box-shadow: 0 6px 20px rgba(16, 128, 137, 0.06);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            align-items: baseline;
        }

        .result-title {
            font-weight: 700;
            color: #0f3740;
            font-size: 1.02em;
        }

        .result-sub {
            color: #557;
            font-size: 0.9em;
        }

        .price {
            background: #e6fffb;
            color: #006d63;
            padding: 6px 10px;
            border-radius: 999px;
            font-weight: 700;
            font-size: 0.95em;
        }

        .result-body {
            margin-top: 10px;
            color: #304;
            font-size: 0.95em;
            line-height: 1.3;
        }

        .result-highlights {
            margin-top: 10px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .badge {
            background: #dff7f5;
            color: #006d63;
            padding: 6px 8px;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .result-actions {
            margin-top: 12px;
            display: flex;
            gap: 10px;
        }

        .btn-link {
            background: transparent;
            border: 1px solid #cfeef6;
            padding: 8px 10px;
            border-radius: 8px;
            color: #0b5960;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.92em;
        }

        .btn-book {
            background: linear-gradient(180deg, #ffd24d 0%, #ffb703 100%);
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            color: #2b1f00;
            font-weight: 700;
            text-decoration: none;
        }

        .loading {
            text-align: center;
            color: #2a6b6d;
            font-weight: 600;
        }

        .error {
            color: #b00020;
            background: #fff0f0;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ffd5d5;
        }

        .calendar {
            margin-bottom: 40px;
        }

        .calendar h2 {
            color: #2b8fb1;
            margin-bottom: 20px;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        th {
            background: #2b8fb1;
            color: white;
            padding: 15px;
            font-weight: 600;
            text-align: center;
        }

        td {
            border: 1px solid #ddd;
            padding: 15px;
            vertical-align: top;
            height: 100px;
            width: 14.28%;
            position: relative;
        }

        .day-number {
            font-weight: bold;
            font-size: 1.1em;
            color: #333;
            margin-bottom: 5px;
        }

        .event {
            font-size: 0.85em;
            padding: 3px 6px;
            border-radius: 4px;
            margin: 3px 0;
            display: block;
        }

        .uiuc-break {
            background: #ffd700;
            color: #333;
            font-weight: 500;
        }

        .nt-midterms {
            background: #ff6b6b;
            color: white;
            font-weight: 500;
        }

        .late-arrival {
            background: #4ecdc4;
            color: white;
            font-weight: 500;
        }

        .nt-break {
            background: #95e1d3;
            color: #333;
            font-weight: 500;
        }

        .empty {
            background: #f8f9fa;
        }

        .highlight {
            background: #fff9e6;
        }

        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            margin-right: 15px;
        }

        .legend-text {
            flex: 1;
        }

        .legend-title {
            font-weight: 600;
            color: #333;
        }

        .legend-dates {
            font-size: 0.9em;
            color: #666;
        }

        .planning-section {
            margin-top: 40px;
        }

        .planning-section h2 {
            color: #2b8fb1;
            margin-bottom: 20px;
        }

        .info-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .info-box h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .info-box ul {
            list-style: none;
            padding-left: 0;
        }

        .info-box li {
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-box li:last-child {
            border-bottom: none;
        }

        .highlight-box {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #f0c419;
        }

        .highlight-box strong {
            color: #333;
            font-size: 1.1em;
        }

        .checklist {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #2b8fb1;
        }

        .checklist label {
            display: flex;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .checklist label:hover {
            background: #f8f9fa;
            border-radius: 5px;
        }

        .checklist input[type="checkbox"] {
            margin-right: 10px;
            width: 20px;
            height: 20px;
        }

        /* Forum styles */
        .forum {
            margin-top: 30px;
        }

        .forum-form {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .forum-form input[type="text"], .forum-form textarea {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e0eef0;
            font-size: 0.95em;
            width: 100%;
        }

        .forum-form textarea { min-height: 80px; resize: vertical; }

        .forum-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .forum-note {
            font-size: 0.9em;
            color: #556;
            margin-bottom: 8px;
        }

        .comments-list {
            margin-top: 12px;
            border-top: 1px solid #eee;
            padding-top: 12px;
        }

        .comment-item {
            padding: 12px;
            border-radius: 8px;
            background: #fff;
            border: 1px solid #f0f6f7;
            margin-bottom: 8px;
        }

        .comment-meta {
            color: #667;
            font-size: 0.85em;
            margin-bottom: 6px;
        }

        .comment-text {
            color: #222;
            font-size: 0.95em;
        }

        .small-btn {
            padding: 8px 10px;
            border-radius: 8px;
            border: 1px solid #cfeef6;
            background: #f8feff;
            cursor: pointer;
        }

        .forum-footer {
            margin-top: 8px;
            font-size: 0.9em;
            color: #666;
        }

        .api-note {
            margin-top: 8px;
            font-size: 0.9em;
            color: #445;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå¥ Galantowicz Spring Break 2026 üå¥</h1>
        <p class="subtitle">Planning the Perfect Spring Break</p>

        <!-- AI Search bar inserted at the top -->
        <div class="ai-search" aria-label="AI travel search">
            <form id="ai-search-form" role="search" aria-labelledby="ai-search-label">
                <input
                    id="ai-search-input"
                    type="search"
                    name="q"
                    placeholder="Search travel destinations and affordable options (e.g. 'warm beaches under $600, family-friendly')"
                    aria-label="Search travel destinations"
                    required
                />
                <select id="ai-budget" aria-label="Budget preference">
                    <option value="affordable" selected>Affordable</option>
                    <option value="moderate">Moderate</option>
                    <option value="luxury">Luxury</option>
                </select>
                <button type="submit" aria-label="Search">AI Search</button>
            </form>
        </div>

        <div class="search-meta">
            Results go through Google
        </div>

        <div id="search-results" aria-live="polite" aria-atomic="true"></div>

<script src="https://giscus.app/client.js"
        data-repo="dgalanto/spring-break-2026"
        data-repo-id="R_kgDOREVqsQ"
        data-category="General"
        data-category-id="DIC_kwDOREVqsc4C1nhS"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
        
        <div class="calendar">
            <h2>March 2026 Calendar</h2>
            <table>
                <thead>
                    <tr>
                        <th>Sunday</th>
                        <th>Monday</th>
                        <th>Tuesday</th>
                        <th>Wednesday</th>
                        <th>Thursday</th>
                        <th>Friday</th>
                        <th>Saturday</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><div class="day-number">1</div></td>
                        <td><div class="day-number">2</div></td>
                        <td><div class="day-number">3</div></td>
                        <td><div class="day-number">4</div></td>
                        <td><div class="day-number">5</div></td>
                        <td><div class="day-number">6</div></td>
                        <td><div class="day-number">7</div></td>
                    </tr>
                    <tr>
                        <td><div class="day-number">8</div></td>
                        <td><div class="day-number">9</div></td>
                        <td>
                            <div class="day-number">10</div>
                            <span class="event nt-midterms">üìö NT Midterms</span>
                        </td>
                        <td>
                            <div class="day-number">11</div>
                            <span class="event nt-midterms">üìö NT Midterms</span>
                        </td>
                        <td>
                            <div class="day-number">12</div>
                            <span class="event nt-midterms">üìö NT Midterms</span>
                        </td>
                        <td>
                            <div class="day-number">13</div>
                            <span class="event nt-midterms">üìö NT Midterms</span>
                        </td>
                        <td>
                            <div class="day-number">14</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="day-number">15</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                        </td>
                        <td class="highlight">
                            <div class="day-number">16</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                            <span class="event late-arrival">‚è∞ Late Arrival NT</span>
                        </td>
                        <td class="highlight">
                            <div class="day-number">17</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                            <span class="event late-arrival">‚è∞ Late Arrival NT</span>
                        </td>
                        <td>
                            <div class="day-number">18</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                        </td>
                        <td>
                            <div class="day-number">19</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                        </td>
                        <td>
                            <div class="day-number">20</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                        </td>
                        <td>
                            <div class="day-number">21</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="day-number">22</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                        </td>
                        <td><div class="day-number">23</div></td>
                        <td><div class="day-number">24</div></td>
                        <td><div class="day-number">25</div></td>
                        <td><div class="day-number">26</div></td>
                        <td><div class="day-number">27</div></td>
                        <td>
                            <div class="day-number">28</div>
                            <span class="event nt-break">üèñÔ∏è NT Spring Break</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="day-number">29</div>
                            <span class="event nt-break">üèñÔ∏è NT Spring Break</span>
                        </td>
                        <td>
                            <div class="day-number">30</div>
                            <span class="event nt-break">üèñÔ∏è NT Spring Break</span>
                        </td>
                        <td><div class="day-number">31</div></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color uiuc-break"></div>
                <div class="legend-text">
                    <div class="legend-title">üéì UIUC Spring Break</div>
                    <div class="legend-dates">March 14-22</div>
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color nt-midterms"></div>
                <div class="legend-text">
                    <div class="legend-title">üìö New Trier Midterms</div>
                    <div class="legend-dates">March 10-13</div>
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color late-arrival"></div>
                <div class="legend-text">
                    <div class="legend-title">‚è∞ Late Arrival NT</div>
                    <div class="legend-dates">March 16-17</div>
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color nt-break"></div>
                <div class="legend-text">
                    <div class="legend-title">üèñÔ∏è NT Spring Break</div>
                    <div class="legend-dates">March 28-30</div>
                </div>
            </div>
        </div>

        <div class="highlight-box">
            <strong>‚ú® Best Window for Family Trip:</strong> March 16-17<br/>
            UIUC is on spring break and New Trier has late arrival those days!
        </div>

        <div class="planning-section">
            <h2>üìã Planning Details</h2>

            <div class="info-box">
                <h3>Key Dates Overview</h3>
                <ul>
                    <li><strong>New Trier Midterms:</strong> March 10-13</li>
                    <li><strong>UIUC Spring Break:</strong> March 14-22 (9 days)</li>
                    <li><strong>Late Arrival at New Trier:</strong> March 16-17</li>
                    <li><strong>New Trier Spring Break:</strong> March 28-30</li>
                </ul>
            </div>

            <div class="info-box">
                <h3>Availability Analysis</h3>
                <ul>
                    <li><strong>Optimal family trip window:</strong> March 16-17 (both have flexibility)</li>
                    <li><strong>UIUC only available:</strong> March 14-15, 18-22</li>
                    <li><strong>Note:</strong> No overlapping full break periods</li>
                </ul>
            </div>

            <div class="checklist">
                <h3>‚úÖ Planning Checklist</h3>
                <label><input type="checkbox"> Research destination options</label>
                <label><input type="checkbox"> Check flight/transportation availability</label>
                <label><input type="checkbox"> Compare accommodation options</label>
                <label><input type="checkbox"> Set budget for the trip</label>
                <label><input type="checkbox"> Create activities wish list</label>
                <label><input type="checkbox"> Book transportation</label>
                <label><input type="checkbox"> Reserve accommodation</label>
                <label><input type="checkbox"> Plan daily itinerary</label>
                <label><input type="checkbox"> Create packing list</label>
                <label><input type="checkbox"> Arrange pet care (if needed)</label>
                <label><input type="checkbox"> Set up travel insurance</label>
                <label><input type="checkbox"> Confirm all reservations</label>
            </div>
        </div>

        <!-- Optional simple forum area (local-first) -->
        <div class="forum">
            <h2>üí¨ Forum</h2>
            <div class="forum-note">Share ideas ‚Äî posts are saved locally and will attempt to sync if a server endpoint exists.</div>
            <form id="forum-form" class="forum-form" aria-label="Forum form">
                <input id="forum-name" type="text" placeholder="Your name" />
                <textarea id="forum-comment" placeholder="Share a thought..."></textarea>
                <div class="forum-actions">
                    <button id="forum-submit" class="small-btn" type="submit">Post</button>
                    <button id="clear-comments" type="button" class="small-btn">Clear</button>
                </div>
            </form>
            <div id="forum-sync-note" class="forum-note"></div>
            <div id="comments-list" class="comments-list"></div>
        </div>
    </div>

    <!-- AI search script (client-side) -->
    <script>
        // Front-end: AI search with server proxy fallback to Google (no local mock results)
        const form = document.getElementById('ai-search-form');
        const input = document.getElementById('ai-search-input');
        const budgetSelect = document.getElementById('ai-budget');
        const resultsEl = document.getElementById('search-results');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const query = (input.value || '').trim();
            if (!query) return;
            const budget = budgetSelect.value || 'affordable';
            resultsEl.innerHTML = '<div class="loading">Searching for travel options... ‚úàÔ∏è</div>';

            // Open a fallback window synchronously so popup blockers won't block it.
            // We'll either close it (if proxy returns results) or navigate it to Google (if proxy fails).
            const googleQuery = `${query} ${budget === 'affordable' ? 'budget' : budget}`;
            let fallbackWin = null;
            try {
                // open an initially-blank window in direct response to the submit event
                // This call must happen synchronously after the user gesture to avoid popup blockers.
                fallbackWin = window.open('', '_blank');

                const resp = await fetch('/api/ai-travel-search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query, budget, max_results: 6 })
                });

                if (!resp.ok) {
                    const body = await resp.text().catch(() => '');
                    throw new Error(`Proxy error: ${resp.status} ${body}`);
                }

                const data = await resp.json();
                const results = Array.isArray(data) ? data : (Array.isArray(data.results) ? data.results : []);

                // proxy worked ‚Äî close the fallback tab if it exists
                if (fallbackWin && !fallbackWin.closed) {
                    try { fallbackWin.close(); } catch (err) { /* ignore */ }
                }

                renderResults(results);
                return;
            } catch (err) {
                console.warn('Search proxy failed:', err);

                // Use the previously-opened window to navigate to Google so it's not blocked.
                try {
                    if (fallbackWin && !fallbackWin.closed) {
                        fallbackWin.location.href = 'https://www.google.com/search?q=' + encodeURIComponent(googleQuery);
                    } else {
                        // if the fallback window was closed by the user or didn't open, open one now (may be blocked)
                        window.open('https://www.google.com/search?q=' + encodeURIComponent(googleQuery), '_blank');
                    }
                } catch (e) { /* ignore */ }

                // No local mock results by design ‚Äî inform the user.
                resultsEl.innerHTML = '<div class="loading">The search was opened in Google (new tab). If nothing opened, please allow popups or try again.</div>';
            }
        });

        function renderResults(items) {
            if (!items || items.length === 0) {
                // No results ‚Äî clear previous results and do not show the old error banner.
                resultsEl.innerHTML = '';
                return;
            }
            resultsEl.innerHTML = '';
            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'result-card';

                const title = document.createElement('div');
                title.className = 'result-title';
                title.textContent = item.title || 'Unknown destination';

                const sub = document.createElement('div');
                sub.className = 'result-sub';
                sub.textContent = item.country ? item.country + (item.duration ? ' ‚Ä¢ ' + item.duration : '') : (item.duration || '');

                const header = document.createElement('div');
                header.className = 'result-header';
                header.appendChild(title);

                const price = document.createElement('div');
                price.className = 'price';
                price.textContent = (typeof item.price_estimate === 'number') ? `$${item.price_estimate}` : (item.price_estimate || 'Varies');

                header.appendChild(price);

                const body = document.createElement('div');
                body.className = 'result-body';
                body.innerHTML = item.description ? sanitizeHTML(item.description) : (item.highlights ? 'Highlights:' : '');

                const highlights = document.createElement('div');
                highlights.className = 'result-highlights';
                if (Array.isArray(item.highlights)) {
                    item.highlights.slice(0,6).forEach(h => {
                        const b = document.createElement('div');
                        b.className = 'badge';
                        b.textContent = h;
                        highlights.appendChild(b);
                    });
                }

                const actions = document.createElement('div');
                actions.className = 'result-actions';

                const more = document.createElement('a');
                more.className = 'btn-link';
                more.target = '_blank';
                more.rel = 'noopener noreferrer';
                more.href = item.info_url || item.booking_url || '#';
                more.textContent = 'More Info';

                const book = document.createElement('a');
                book.className = 'btn-book';
                book.target = '_blank';
                book.rel = 'noopener noreferrer';
                book.href = item.booking_url || item.info_url || '#';
                book.textContent = 'Book';

                actions.appendChild(more);
                actions.appendChild(book);

                card.appendChild(header);
                card.appendChild(sub);
                if (body.textContent && body.textContent.trim()) card.appendChild(body);
                if (highlights.children.length) card.appendChild(highlights);
                card.appendChild(actions);

                resultsEl.appendChild(card);
            });
        }

        function sanitizeHTML(str) {
            if (!str) return '';
            const tmp = document.createElement('div');
            tmp.textContent = str;
            return tmp.innerHTML;
        }

        // ---- Forum (local-first) ----
        const forumForm = document.getElementById('forum-form');
        const forumName = document.getElementById('forum-name');
        const forumComment = document.getElementById('forum-comment');
        const commentsList = document.getElementById('comments-list');
        const forumSyncNote = document.getElementById('forum-sync-note');
        const clearBtn = document.getElementById('clear-comments');

        function loadComments() {
            try {
                const raw = localStorage.getItem('sb_comments_v1');
                return raw ? JSON.parse(raw) : [];
            } catch (e) {
                return [];
            }
        }

        function saveComments(comments) {
            try {
                localStorage.setItem('sb_comments_v1', JSON.stringify(comments));
            } catch (e) {
                // ignore quota errors
            }
        }

        function renderComments() {
            const comments = loadComments();
            commentsList.innerHTML = '';
            if (!comments.length) {
                commentsList.innerHTML = '<div class="forum-note">No posts yet ‚Äî be the first!</div>';
                return;
            }
            comments.forEach(c => {
                const item = document.createElement('div');
                item.className = 'comment-item';

                const meta = document.createElement('div');
                meta.className = 'comment-meta';
                const when = new Date(c.ts).toLocaleString();
                meta.textContent = `${c.name || 'Anonymous'} ‚Ä¢ ${when}`;

                const text = document.createElement('div');
                text.className = 'comment-text';
                text.textContent = c.text;

                item.appendChild(meta);
                item.appendChild(text);
                commentsList.appendChild(item);
            });
        }

        forumForm.addEventListener('submit', (ev) => {
            ev.preventDefault();
            const name = (forumName.value || '').trim();
            const text = (forumComment.value || '').trim();
            if (!text) return;
            const comments = loadComments();
            const entry = { name: name || 'Anonymous', text, ts: Date.now() };
            comments.unshift(entry);
            saveComments(comments);
            renderComments();
            forumName.value = '';
            forumComment.value = '';

            // Try to sync to an API endpoint if available (non-blocking)
            if (navigator.onLine) {
                try {
                    fetch('/api/comments', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(entry)
                    }).then(resp => {
                        if (resp && resp.ok) {
                            forumSyncNote.textContent = 'Comment posted and synced.';
                            setTimeout(() => forumSyncNote.textContent = '', 3000);
                        } else {
                            forumSyncNote.textContent = 'Comment saved locally (sync failed).';
                            setTimeout(() => forumSyncNote.textContent = '', 3000);
                        }
                    }).catch(() => {
                        forumSyncNote.textContent = 'Comment saved locally (offline or network error).';
                        setTimeout(() => forumSyncNote.textContent = '', 3000);
                    });
                } catch (e) {
                    // ignore
                }
            } else {
                forumSyncNote.textContent = 'You are offline ‚Äî comment saved locally.';
                setTimeout(() => forumSyncNote.textContent = '', 3000);
            }
        });

        clearBtn.addEventListener('click', () => {
            if (!confirm('Clear all local posts? This cannot be undone.')) return;
            localStorage.removeItem('sb_comments_v1');
            renderComments();
            forumSyncNote.textContent = 'Local posts cleared.';
            setTimeout(() => forumSyncNote.textContent = '', 3000);
        });

        // initial render
        renderComments();

    </script>
</body>
</html>
