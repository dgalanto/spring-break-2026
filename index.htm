<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Galantowicz Spring Break 2026 Planning</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* Updated to a light, neutral cyan/blue gradient */
            background: linear-gradient(135deg, #e6fbff 0%, #d0f0f7 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.12);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 8px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 1.05em;
        }

        /* Search bar */
        .ai-search {
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: center;
            margin: 18px 0 30px 0;
        }

        .ai-search form {
            display: flex;
            gap: 10px;
            width: 100%;
            max-width: 900px;
            align-items: center;
        }

        .ai-search input[type="search"] {
            flex: 1;
            padding: 12px 14px;
            border-radius: 10px;
            border: 1px solid #cfeef6;
            background: #f7feff;
            font-size: 1em;
            outline: none;
            transition: box-shadow 0.12s;
        }

        .ai-search input[type="search"]:focus {
            box-shadow: 0 0 0 4px rgba(34, 193, 195, 0.08);
            border-color: #4ecdc4;
        }

        .ai-search select {
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #e0f2f5;
            background: #fff;
            font-size: 0.95em;
        }

        .ai-search button {
            padding: 11px 18px;
            background: linear-gradient(180deg, #2bb7c7 0%, #19a8b7 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.08s;
        }

        .ai-search button:active {
            transform: translateY(1px);
        }

        .search-meta {
            text-align: center;
            font-size: 0.9em;
            color: #556;
            margin-bottom: 18px;
        }

        /* Results */
        #search-results {
            margin-top: 18px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 16px;
        }

        .result-card {
            background: linear-gradient(180deg, #ffffff 0%, #fbffff 100%);
            border: 1px solid #e6f7f9;
            border-radius: 12px;
            padding: 14px;
            box-shadow: 0 6px 20px rgba(16, 128, 137, 0.06);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            align-items: baseline;
        }

        .result-title {
            font-weight: 700;
            color: #0f3740;
            font-size: 1.02em;
        }

        .result-sub {
            color: #557;
            font-size: 0.9em;
        }

        .price {
            background: #e6fffb;
            color: #006d63;
            padding: 6px 10px;
            border-radius: 999px;
            font-weight: 700;
            font-size: 0.95em;
        }

        .result-body {
            margin-top: 10px;
            color: #304;
            font-size: 0.95em;
            line-height: 1.3;
        }

        .result-highlights {
            margin-top: 10px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .badge {
            background: #dff7f5;
            color: #006d63;
            padding: 6px 8px;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .result-actions {
            margin-top: 12px;
            display: flex;
            gap: 10px;
        }

        .btn-link {
            background: transparent;
            border: 1px solid #cfeef6;
            padding: 8px 10px;
            border-radius: 8px;
            color: #0b5960;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.92em;
        }

        .btn-book {
            background: linear-gradient(180deg, #ffd24d 0%, #ffb703 100%);
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            color: #2b1f00;
            font-weight: 700;
            text-decoration: none;
        }

        .loading {
            text-align: center;
            color: #2a6b6d;
            font-weight: 600;
        }

        .error {
            color: #b00020;
            background: #fff0f0;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ffd5d5;
        }

        .calendar {
            margin-bottom: 40px;
        }

        .calendar h2 {
            color: #2b8fb1;
            margin-bottom: 20px;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        th {
            background: #2b8fb1;
            color: white;
            padding: 15px;
            font-weight: 600;
            text-align: center;
        }

        td {
            border: 1px solid #ddd;
            padding: 15px;
            vertical-align: top;
            height: 100px;
            width: 14.28%;
            position: relative;
        }

        .day-number {
            font-weight: bold;
            font-size: 1.1em;
            color: #333;
            margin-bottom: 5px;
        }

        .event {
            font-size: 0.85em;
            padding: 3px 6px;
            border-radius: 4px;
            margin: 3px 0;
            display: block;
        }

        .uiuc-break {
            background: #ffd700;
            color: #333;
            font-weight: 500;
        }

        .nt-midterms {
            background: #ff6b6b;
            color: white;
            font-weight: 500;
        }

        .late-arrival {
            background: #4ecdc4;
            color: white;
            font-weight: 500;
        }

        .nt-break {
            background: #95e1d3;
            color: #333;
            font-weight: 500;
        }

        .empty {
            background: #f8f9fa;
        }

        .highlight {
            background: #fff9e6;
        }

        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            margin-right: 15px;
        }

        .legend-text {
            flex: 1;
        }

        .legend-title {
            font-weight: 600;
            color: #333;
        }

        .legend-dates {
            font-size: 0.9em;
            color: #666;
        }

        .planning-section {
            margin-top: 40px;
        }

        .planning-section h2 {
            color: #2b8fb1;
            margin-bottom: 20px;
        }

        .info-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .info-box h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .info-box ul {
            list-style: none;
            padding-left: 0;
        }

        .info-box li {
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-box li:last-child {
            border-bottom: none;
        }

        .highlight-box {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #f0c419;
        }

        .highlight-box strong {
            color: #333;
            font-size: 1.1em;
        }

        .checklist {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #2b8fb1;
        }

        .checklist label {
            display: flex;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .checklist label:hover {
            background: #f8f9fa;
            border-radius: 5px;
        }

        .checklist input[type="checkbox"] {
            margin-right: 10px;
            width: 20px;
            height: 20px;
        }

        /* forum/collapsible */
        .forum-section {
            margin-bottom: 28px;
        }

        details.forum details {
            margin-bottom: 12px;
        }

        details.forum summary {
            font-weight: 700;
            font-size: 1.05em;
            padding: 12px 16px;
            border-radius: 10px;
            background: #f1fcff;
            border: 1px solid #d9f6f8;
            cursor: pointer;
            color: #0b5960;
            list-style: none;
        }

        .forum-body {
            padding: 16px;
            border: 1px solid #eef9fa;
            border-top: none;
            background: #ffffff;
            border-radius: 0 0 10px 10px;
        }

        .forum-form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .forum-form-row input[type="text"],
        .forum-form-row textarea {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e0f2f5;
            width: 100%;
            font-size: 0.95em;
        }

        .forum-form-row input[type="text"] {
            max-width: 220px;
        }

        .forum-form-row textarea {
            min-height: 72px;
            resize: vertical;
            flex: 1;
        }

        .forum-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .forum-btn {
            padding: 8px 12px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            background: linear-gradient(180deg, #2bb7c7 0%, #19a8b7 100%);
            color: white;
            font-weight: 600;
        }

        .comment-list {
            margin-top: 14px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .comment-item {
            padding: 12px;
            border-radius: 8px;
            background: #f8f9fa;
            border: 1px solid #e6f7f9;
        }

        .comment-meta {
            font-size: 0.9em;
            color: #556;
            margin-bottom: 6px;
        }

        .comment-text {
            font-size: 0.95em;
            color: #213;
            line-height: 1.3;
        }

        .comment-actions {
            margin-top: 8px;
            display: flex;
            gap: 8px;
        }

        .small-btn {
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #d0eef2;
            background: white;
            cursor: pointer;
            font-size: 0.85em;
            color: #0b5960;
        }

        .api-note {
            margin-top: 8px;
            font-size: 0.9em;
            color: #445;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå¥ Galantowicz Spring Break 2026 üå¥</h1>
        <p class="subtitle">Planning the Perfect Spring Break</p>

        <!-- AI Search bar inserted at the top -->
        <div class="ai-search" aria-label="AI travel search">
            <form id="ai-search-form" role="search" aria-labelledby="ai-search-label">
                <input
                    id="ai-search-input"
                    type="search"
                    name="q"
                    placeholder="Search travel destinations and affordable options (e.g. 'warm beaches under $600, family-friendly')"
                    aria-label="Search travel destinations"
                    required
                />
                <select id="ai-budget" aria-label="Budget preference">
                    <option value="affordable" selected>Affordable</option>
                    <option value="moderate">Moderate</option>
                    <option value="luxury">Luxury</option>
                </select>
                <button type="submit" aria-label="Search">AI Search</button>
            </form>
        </div>

        <div class="search-meta">
            Results use an AI-powered search (client makes request to your server-side Gemini endpoint). If no endpoint is configured the page will show sample/mock affordable options.
        </div>

        <div id="search-results" aria-live="polite" aria-atomic="true"></div>

        <!-- Collapsible forum inserted above the calendar -->
        <div class="forum-section">
            <details class="forum" open>
                <summary>üí¨ Trip Discussion Forum ‚Äî Add your name and comment</summary>
                <div class="forum-body">
                    <form id="forum-form" aria-label="Trip discussion form">
                        <div class="forum-form-row">
                            <input id="forum-name" name="name" type="text" placeholder="Your name" aria-label="Your name" required>
                            <textarea id="forum-comment" name="comment" placeholder="Share ideas, questions, or plans..." aria-label="Comment" required></textarea>
                        </div>
                        <div class="forum-actions">
                            <button class="forum-btn" type="submit">Post Comment</button>
                            <button class="small-btn" id="clear-comments" type="button">Clear Local Comments</button>
                        </div>
                    </form>

                    <div id="comments-list" class="comment-list" aria-live="polite" aria-atomic="true"></div>
                    <div class="api-note" id="forum-sync-note"></div>
                </div>
            </details>
        </div>

        <div class="calendar">
            <h2>üìÖ March 2026 Calendar</h2>
            <table>
                <thead>
                    <tr>
                        <th>Sunday</th>
                        <th>Monday</th>
                        <th>Tuesday</th>
                        <th>Wednesday</th>
                        <th>Thursday</th>
                        <th>Friday</th>
                        <th>Saturday</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><div class="day-number">1</div></td>
                        <td><div class="day-number">2</div></td>
                        <td><div class="day-number">3</div></td>
                        <td><div class="day-number">4</div></td>
                        <td><div class="day-number">5</div></td>
                        <td><div class="day-number">6</div></td>
                        <td><div class="day-number">7</div></td>
                    </tr>
                    <tr>
                        <td><div class="day-number">8</div></td>
                        <td><div class="day-number">9</div></td>
                        <td>
                            <div class="day-number">10</div>
                            <span class="event nt-midterms">üìö NT Midterms</span>
                        </td>
                        <td>
                            <div class="day-number">11</div>
                            <span class="event nt-midterms">üìö NT Midterms</span>
                        </td>
                        <td>
                            <div class="day-number">12</div>
                            <span class="event nt-midterms">üìö NT Midterms</span>
                        </td>
                        <td>
                            <div class="day-number">13</div>
                            <span class="event nt-midterms">üìö NT Midterms</span>
                        </td>
                        <td>
                            <div class="day-number">14</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="day-number">15</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                        </td>
                        <td class="highlight">
                            <div class="day-number">16</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                            <span class="event late-arrival">‚è∞ Late Arrival NT</span>
                        </td>
                        <td class="highlight">
                            <div class="day-number">17</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                            <span class="event late-arrival">‚è∞ Late Arrival NT</span>
                        </td>
                        <td>
                            <div class="day-number">18</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                        </td>
                        <td>
                            <div class="day-number">19</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                        </td>
                        <td>
                            <div class="day-number">20</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                        </td>
                        <td>
                            <div class="day-number">21</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="day-number">22</div>
                            <span class="event uiuc-break">üéì UIUC Break</span>
                        </td>
                        <td><div class="day-number">23</div></td>
                        <td><div class="day-number">24</div></td>
                        <td><div class="day-number">25</div></td>
                        <td><div class="day-number">26</div></td>
                        <td><div class="day-number">27</div></td>
                        <td>
                            <div class="day-number">28</div>
                            <span class="event nt-break">üèñÔ∏è NT Spring Break</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="day-number">29</div>
                            <span class="event nt-break">üèñÔ∏è NT Spring Break</span>
                        </td>
                        <td>
                            <div class="day-number">30</div>
                            <span class="event nt-break">üèñÔ∏è NT Spring Break</span>
                        </td>
                        <td><div class="day-number">31</div>
                            <span class="event nt-break">üèñÔ∏è NT Spring Break</span>
                        </td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color uiuc-break"></div>
                <div class="legend-text">
                    <div class="legend-title">üéì UIUC Spring Break</div>
                    <div class="legend-dates">March 14-22</div>
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color nt-midterms"></div>
                <div class="legend-text">
                    <div class="legend-title">üìö New Trier Midterms</div>
                    <div class="legend-dates">March 10-13</div>
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color late-arrival"></div>
                <div class="legend-text">
                    <div class="legend-title">‚è∞ Late Arrival NT</div>
                    <div class="legend-dates">March 16-17</div>
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color nt-break"></div>
                <div class="legend-text">
                    <div class="legend-title">üèñÔ∏è NT Spring Break</div>
                    <div class="legend-dates">March 28-30</div>
                </div>
            </div>
        </div>

        <div class="highlight-box">
            <strong>‚ú® Best Window for Family Trip:</strong> March 16-17<br/>
            UIUC is on spring break and New Trier has late arrival those days!
        </div>

        <div class="planning-section">
            <h2>üìã Planning Details</h2>

            <div class="info-box">
                <h3>Key Dates Overview</h3>
                <ul>
                    <li><strong>New Trier Midterms:</strong> March 10-13</li>
                    <li><strong>UIUC Spring Break:</strong> March 14-22 (9 days)</li>
                    <li><strong>Late Arrival at New Trier:</strong> March 16-17</li>
                    <li><strong>New Trier Spring Break:</strong> March 28-30</li>
                </ul>
            </div>

            <div class="info-box">
                <h3>Availability Analysis</h3>
                <ul>
                    <li><strong>Optimal family trip window:</strong> March 16-17 (both have flexibility)</li>
                    <li><strong>UIUC only available:</strong> March 14-15, 18-22</li>
                    <li><strong>Note:</strong> No overlapping full break periods</li>
                </ul>
            </div>

            <div class="checklist">
                <h3>‚úÖ Planning Checklist</h3>
                <label><input type="checkbox"> Research destination options</label>
                <label><input type="checkbox"> Check flight/transportation availability</label>
                <label><input type="checkbox"> Compare accommodation options</label>
                <label><input type="checkbox"> Set budget for the trip</label>
                <label><input type="checkbox"> Create activities wish list</label>
                <label><input type="checkbox"> Book transportation</label>
                <label><input type="checkbox"> Reserve accommodation</label>
                <label><input type="checkbox"> Plan daily itinerary</label>
                <label><input type="checkbox"> Create packing list</label>
                <label><input type="checkbox"> Arrange pet care (if needed)</label>
                <label><input type="checkbox"> Set up travel insurance</label>
                <label><input type="checkbox"> Confirm all reservations</label>
            </div>
        </div>

        <div class="api-note" id="ai-api-note">
            To enable real AI results with Google Gemini: implement a server endpoint (e.g. POST /api/gemini-search). The endpoint should accept a JSON body:
            { "query": "...", "budget": "affordable|moderate|luxury", "max_results": 6 }
            and return an array of result objects:
            [{ "title": "Canc√∫n, Mexico", "country":"Mexico", "price_estimate":350, "duration":"4 days", "highlights":["family-friendly","beach"], "booking_url":"https://..."}]
            The page will fall back to mock/sample data when no endpoint is available.
            Additionally, the forum will try to POST each comment to POST /api/comments (optional) to allow server-side persistence.
        </div>
    </div>

    <script>
        // Front-end: send query to a server-side Gemini endpoint (no API key on client).
        // Replace '/api/gemini-search' with your own server route that queries Google Gemini.
        // Server should handle API keys, rate limits, and return curated affordable options in the shape expected by renderResults().

        const form = document.getElementById('ai-search-form');
        const input = document.getElementById('ai-search-input');
        const budgetSelect = document.getElementById('ai-budget');
        const resultsEl = document.getElementById('search-results');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const query = input.value.trim();
            if (!query) return;
            const budget = budgetSelect.value || 'affordable';
            resultsEl.innerHTML = '<div class="loading">Searching Google Gemini for travel options... ‚úàÔ∏è</div>';

            try {
                // Call your server-side Gemini proxy
                const resp = await fetch('/api/gemini-search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query, budget, max_results: 6 })
                });

                if (!resp.ok) {
                    // server returned an error or endpoint not implemented -> fallback
                    throw new Error('Server Gemini endpoint unavailable or returned an error');
                }

                const data = await resp.json();
                // Expecting: { results: [ { title, country, price_estimate, duration, highlights, booking_url } ] }
                const results = Array.isArray(data.results) ? data.results : data;
                renderResults(results);
            } catch (err) {
                // Fallback to mock results (useful during local development)
                console.warn('Gemini search failed, using mock results:', err);
                const mock = mockSearch(query, budget);
                renderResults(mock);
            }
        });

        /**
         * Renders an array of result objects to #search-results
         * Each item: { title, country, price_estimate, duration, highlights, booking_url }
         */
        function renderResults(items) {
            if (!items || items.length === 0) {
                resultsEl.innerHTML = '<div class="error">No options found. Try a different query or check your server Gemini endpoint.</div>';
                return;
            }

            resultsEl.innerHTML = '';
            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'result-card';

                const title = document.createElement('div');
                title.className = 'result-title';
                title.textContent = item.title || 'Unknown destination';

                const sub = document.createElement('div');
                sub.className = 'result-sub';
                sub.textContent = item.country ? item.country + (item.duration ? ' ‚Ä¢ ' + item.duration : '') : (item.duration || '');

                const header = document.createElement('div');
                header.className = 'result-header';
                header.appendChild(title);

                const price = document.createElement('div');
                price.className = 'price';
                price.textContent = (typeof item.price_estimate === 'number') ? `$${item.price_estimate}` : (item.price_estimate || 'Varies');

                header.appendChild(price);

                const body = document.createElement('div');
                body.className = 'result-body';
                body.innerHTML = item.description ? sanitizeHTML(item.description) : (item.highlights ? 'Highlights:' : '');

                const highlights = document.createElement('div');
                highlights.className = 'result-highlights';
                if (Array.isArray(item.highlights)) {
                    item.highlights.slice(0,6).forEach(h => {
                        const b = document.createElement('div');
                        b.className = 'badge';
                        b.textContent = h;
                        highlights.appendChild(b);
                    });
                }

                const actions = document.createElement('div');
                actions.className = 'result-actions';

                const more = document.createElement('a');
                more.className = 'btn-link';
                more.target = '_blank';
                more.rel = 'noopener noreferrer';
                more.href = item.info_url || item.booking_url || '#';
                more.textContent = 'More Info';

                const book = document.createElement('a');
                book.className = 'btn-book';
                book.target = '_blank';
                book.rel = 'noopener noreferrer';
                book.href = item.booking_url || item.info_url || '#';
                book.textContent = 'Book';

                actions.appendChild(more);
                actions.appendChild(book);

                card.appendChild(header);
                card.appendChild(sub);
                if (body.textContent.trim()) card.appendChild(body);
                if (highlights.children.length) card.appendChild(highlights);
                card.appendChild(actions);

                resultsEl.appendChild(card);
            });
        }

        // Simple HTML sanitizer for small descriptions coming from trusted sources.
        function sanitizeHTML(str) {
            if (!str) return '';
            const tmp = document.createElement('div');
            tmp.textContent = str;
            return tmp.innerHTML;
        }

        // Mock search results to use when server is not available.
        function mockSearch(query, budget) {
            // Provide a few affordable example options; in real usage replace with server-powered AI results.
            const affordable = [
                {
                    title: 'Myrtle Beach, South Carolina',
                    country: 'USA',
                    price_estimate: 320,
                    duration: '4 days',
                    highlights: ['beach', 'family-friendly', 'budget hotels', 'short flights'],
                    booking_url: 'https://www.example.com/book/myrtle-beach',
                    info_url: 'https://en.wikipedia.org/wiki/Myrtle_Beach'
                },
                {
                    title: 'Canc√∫n (budget package)',
                    country: 'Mexico',
                    price_estimate: 450,
                    duration: '5 days',
                    highlights: ['all-inclusive deals', 'beach', 'warm weather'],
                    booking_url: 'https://www.example.com/book/cancun',
                    info_url: 'https://en.wikipedia.org/wiki/Canc%C3%BAn'
                },
                {
                    title: 'Gulf Shores, Alabama',
                    country: 'USA',
                    price_estimate: 290,
                    duration: '3 days',
                    highlights: ['short drive', 'affordable rentals', 'family-centred'],
                    booking_url: 'https://www.example.com/book/gulf-shores',
                    info_url: 'https://en.wikipedia.org/wiki/Gulf_Shores,_Alabama'
                },
                {
                    title: 'Puerto Vallarta (flight deals)',
                    country: 'Mexico',
                    price_estimate: 420,
                    duration: '5 days',
                    highlights: ['cheap flights', 'beach & culture', 'food'],
                    booking_url: 'https://www.example.com/book/puerto-vallarta',
                    info_url: 'https://en.wikipedia.org/wiki/Puerto_Vallarta'
                },
                {
                    title: 'San Diego, California (deal hotels)',
                    country: 'USA',
                    price_estimate: 380,
                    duration: '4 days',
                    highlights: ['mild weather', 'family activities', 'beach'],
                    booking_url: 'https://www.example.com/book/san-diego',
                    info_url: 'https://en.wikipedia.org/wiki/San_Diego'
                },
                {
                    title: 'Fort Lauderdale (flight+hotel)',
                    country: 'USA',
                    price_estimate: 340,
                    duration: '4 days',
                    highlights: ['beach', 'easy flights', 'budget-friendly'],
                    booking_url: 'https://www.example.com/book/ft-lauderdale',
                    info_url: 'https://en.wikipedia.org/wiki/Fort_Lauderdale,_Florida'
                }
            ];

            // Basic filter by query keywords (very naive)
            const q = (query || '').toLowerCase();
            const filtered = affordable.filter(item =>
                item.title.toLowerCase().includes(q) ||
                item.highlights.join(' ').toLowerCase().includes(q) ||
                item.country.toLowerCase().includes(q) ||
                q === '' // include all if no specific term
            );

            // sort by price for "affordable"
            if (budget === 'affordable') {
                filtered.sort((a, b) => (a.price_estimate || 9999) - (b.price_estimate || 9999));
            }

            return filtered.slice(0, 6);
        }

        // ------------------------------
        // Forum: localStorage + server sync (/api/comments)
        // ------------------------------

        const forumForm = document.getElementById('forum-form');
        const forumName = document.getElementById('forum-name');
        const forumComment = document.getElementById('forum-comment');
        const commentsListEl = document.getElementById('comments-list');
        const clearCommentsBtn = document.getElementById('clear-comments');
        const forumSyncNote = document.getElementById('forum-sync-note');

        const STORAGE_KEY = 'sb_comments_v1';

        // Load and render comments on start
        document.addEventListener('DOMContentLoaded', () => {
            renderComments(loadComments());
            checkCommentsEndpoint();
        });

        // Improved submit handler: optimistic UI + replace temp local comment with server-saved comment
        forumForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = (forumName.value || '').trim();
            const text = (forumComment.value || '').trim();
            if (!name || !text) return;

            // Create a temporary local comment (temp id) so UI is instant
            const tempId = Date.now().toString();
            const tempComment = {
                id: tempId,
                name,
                text,
                created_at: new Date().toISOString(),
                synced: false
            };

            // Save locally first (optimistic UI)
            const comments = loadComments();
            comments.unshift(tempComment);
            saveComments(comments);
            renderComments(comments);
            forumForm.reset();

            // Send minimal payload to server; server will create its own id & created_at
            try {
                const res = await fetch('/api/comments', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: tempComment.name, text: tempComment.text })
                });

                if (!res.ok) {
                    // server returned non-2xx
                    forumSyncNote.textContent = 'Comment saved locally (server sync failed).';
                    setTimeout(() => { forumSyncNote.textContent = ''; }, 3000);
                    return;
                }

                // Parse server-saved comment
                const saved = await res.json();
                // saved should be { id, name, text, created_at }

                // Merge: replace the local temp comment (by tempId) with the server-saved comment and mark synced
                const after = loadComments();
                const idx = after.findIndex(c => c.id === tempId);
                const serverItem = Object.assign({}, saved, { synced: true });
                if (idx >= 0) {
                    after[idx] = serverItem;
                } else {
                    // if somehow not found, add server item to top
                    after.unshift(serverItem);
                }
                saveComments(after);
                renderComments(after);

                forumSyncNote.textContent = 'Comment synced to server.';
                setTimeout(() => { forumSyncNote.textContent = ''; }, 3000);
            } catch (err) {
                // Network/server not available
                forumSyncNote.textContent = 'Comment saved locally. Server sync unavailable.';
                setTimeout(() => { forumSyncNote.textContent = ''; }, 3000);
            }
        });

        clearCommentsBtn.addEventListener('click', () => {
            if (!confirm('Clear all local comments? This cannot be undone.')) return;
            localStorage.removeItem(STORAGE_KEY);
            renderComments([]);
        });

        function loadComments() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                return raw ? JSON.parse(raw) : [];
            } catch (e) {
                return [];
            }
        }

        function saveComments(list) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(list.slice(0, 200))); // cap locally kept comments
            } catch (e) {
                console.warn('Failed to save comments', e);
            }
        }

        function renderComments(list) {
            commentsListEl.innerHTML = '';
            if (!list || list.length === 0) {
                commentsListEl.innerHTML = '<div class="comment-item">No comments yet ‚Äî be the first to share ideas!</div>';
                return;
            }

            list.forEach(c => {
                const item = document.createElement('div');
                item.className = 'comment-item';
                item.setAttribute('data-id', c.id);

                const meta = document.createElement('div');
                meta.className = 'comment-meta';
                const when = new Date(c.created_at).toLocaleString();
                meta.textContent = `${sanitizeHTML(c.name)} ‚Ä¢ ${when}` + (c.synced ? ' ‚Ä¢ synced' : ' ‚Ä¢ local');

                const text = document.createElement('div');
                text.className = 'comment-text';
                text.innerHTML = sanitizeHTML(c.text);

                const actions = document.createElement('div');
                actions.className = 'comment-actions';

                const delBtn = document.createElement('button');
                delBtn.className = 'small-btn';
                delBtn.textContent = 'Delete';
                delBtn.addEventListener('click', () => {
                    deleteComment(c.id);
                });

                actions.appendChild(delBtn);

                item.appendChild(meta);
                item.appendChild(text);
                item.appendChild(actions);

                commentsListEl.appendChild(item);
            });
        }

        function deleteComment(id) {
            let list = loadComments();
            const item = list.find(c => c.id === id);
            list = list.filter(c => c.id !== id);
            saveComments(list);
            renderComments(list);

            // If the id looks like a server id (not a temp timestamp), attempt server delete.
            // Here we treat server ids as any string not equal to a numeric timestamp (simple heuristic).
            const isTemp = /^\d{13,}$/.test(id); // timestamp in ms length ~13
            if (!isTemp) {
                fetch(`/api/comments/${encodeURIComponent(id)}`, {
                    method: 'DELETE'
                }).then(res => {
                    // ignore result; optional
                }).catch(() => {});
            }
        }

        function markCommentSynced(id) {
            const list = loadComments();
            const idx = list.findIndex(c => c.id === id);
            if (idx >= 0) {
                list[idx].synced = true;
                saveComments(list);
                renderComments(list);
            }
        }

        // Optional: try to fetch existing server comments and merge with local
        async function checkCommentsEndpoint() {
            try {
                const res = await fetch('/api/comments');
                if (!res.ok) {
                    forumSyncNote.textContent = 'Server comments endpoint not available.';
                    setTimeout(() => { forumSyncNote.textContent = ''; }, 3000);
                    return;
                }
                const serverComments = await res.json(); // expect array
                if (Array.isArray(serverComments) && serverComments.length) {
                    // Merge: server comments first, then local unique by id
                    const local = loadComments();
                    const map = new Map();
                    serverComments.forEach(c => map.set(c.id, Object.assign({}, c, { synced: true })));
                    local.forEach(c => { if (!map.has(c.id)) map.set(c.id, c); });
                    const merged = Array.from(map.values()).sort((a,b)=> (b.created_at||0) - (a.created_at||0));
                    saveComments(merged);
                    renderComments(merged);
                    forumSyncNote.textContent = 'Loaded comments from server.';
                    setTimeout(() => { forumSyncNote.textContent = ''; }, 3000);
                }
            } catch (err) {
                // ignore ‚Äî optional endpoint
            }
        }
    </script>
</body>
</html>
